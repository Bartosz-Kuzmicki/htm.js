#!/usr/bin/env bash

rm build/htm.js
cd lib/c_ansi
emcc -O1 -s ASM_JS=1 -s TOTAL_MEMORY=33554432 -s EXPORTED_FUNCTIONS="['_jsUpdateSynapseConnected', '_jsIsSynapseConnected', '_jsGetNewSynapse', '_jsGetNewCell', '_newRegion', '_initSynapse', '_isSynapseActive', '_wasSynapseActive', '_wasSynapseActiveFromLearning', '_increaseSynapsePermanence', '_decreaseSynapsePermanence', '_createSynapse', '_processSegment', '_updateSegmentPermanences', '_nextSegmentTimeStep', '_processSegment', '_wasSegmentActiveFromLearning', '_deleteSegment', '_initSegment', '_jsGetNewSegment', '_jsGetSegNumActiveConnectedSyns', '_jsGetSegNumActiveAllSyns', '_jsGetSegIsActive', '_jsGetSegNumPrevActiveConnectedSyns', '_jsGetSegWasActive', '_jsSetCellWasActive', '_jsSetCellWasLearning', '_newRegionHardcoded', '_performSpatialPooling', '_performTemporalPooling', '_runOnce', '_deleteRegion', '_getLastAccuracy', '_newRegion', '_numRegionActiveColumns', '_getColumnPredictions', '_numRegionSegments', '_jsGetCellWasActive', '_jsGetCellWasLearning', '_jsGetColumnFromRegion', '_jsGetCellFromColumn', '_jsGetColumnIsActive', '_jsGetCellNumSegments', '_jsGetSegNumSyns', '_jsGetSegmentFromCell', '_jsGetSynapseFromSegment', '_jsGetSynapseInputSource', '_jsGetCellIsActive', '_jsGetCellIsLearning', '_jsGetFloatItemFromArray', '_jsSetRegionTemporalLearning', '_jsGetRegionNumColumns', '_jsSetDataArr', '_jsGetRegionInhibitionRadius']" JsBindings.c Cell.c Column.c Region.c Segment.c SegmentUpdateInfo.c Synapse.c -o ../../src/htm_c.js
cat ../../src/pre.js ../../src/htm_c.js ../../src/htm_lib.js ../../src/post.js > ../../build/htm.js